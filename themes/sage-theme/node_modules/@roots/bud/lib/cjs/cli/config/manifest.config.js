"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.configs = exports.configSet = void 0;
const bud_support_1 = require("@roots/bud-support");
const { isFunction } = bud_support_1.lodash;
/**
 * @internal
 */
const configSet = async (app, logger, config) => {
    await Promise.all(Object.entries(config).map(async ([key, value]) => {
        const request = app[key];
        logger.log(key, `called on`, app.name);
        if (isFunction(request)) {
            await request(value);
        }
        return;
    }));
};
exports.configSet = configSet;
/**
 * @internal
 */
const configs = async (app, logger) => {
    const generalConfigs = app.project.get('configs.json.global');
    const conditionalConfigs = app.project.get('configs.json.conditional');
    app.dump(generalConfigs, {
        prefix: 'retrieved static config (global)',
    });
    app.dump(generalConfigs, {
        prefix: 'retrieved static config (conditional)',
    });
    if (generalConfigs) {
        await (0, exports.configSet)(app, logger, generalConfigs);
        await app.api.processQueue();
        await app.extensions.processQueue();
    }
    if (conditionalConfigs) {
        await (0, exports.configSet)(app, logger, conditionalConfigs);
        await app.api.processQueue();
        await app.extensions.processQueue();
    }
};
exports.configs = configs;
